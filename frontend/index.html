<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>TDI Takt Time Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', 'Noto Sans KR', sans-serif;
            background: #f4f8fb;
            margin: 0;
            padding: 0;
        }
        .main-flex {
            display: flex;
            gap: 36px;
            max-width: 1100px;
            min-width: 700px;
            margin: 32px auto 0 auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(30, 60, 120, 0.10);
            padding: 24px 18px 18px 18px;
            align-items: flex-start;
        }
        .left-panel {
            flex: 1 1 0;
            min-width: 340px;
            max-width: 520px;
        }
        .right-panel {
            flex: 0 0 340px;
            min-width: 340px;
            max-width: 340px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h2 {
            margin-top: 0;
            margin-bottom: 16px;
            font-size: 1.4rem;
            color: #2563eb;
            font-weight: 700;
            letter-spacing: -1px;
            text-align: center;
        }
        .motion-svg-wrap {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }
        .form-section {
            margin-bottom: 10px;
        }
        .form-title {
            font-size: 1.01rem;
            font-weight: 700;
            color: #2563eb;
            margin-bottom: 4px;
            margin-top: 10px;
        }
        .grid2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px 14px;
        }
        .form-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 0;
        }
        label {
            min-width: 90px;
            color: #1e293b;
            font-size: 0.97rem;
            font-weight: 500;
            margin-bottom: 0;
        }
        input[type="number"], input[type="text"] {
            flex: 1;
            width: 100%;
            box-sizing: border-box;
            padding: 6px 8px;
            border: 1.2px solid #dbeafe;
            border-radius: 7px;
            font-size: 0.97rem;
            background: #f8fafc;
            transition: border 0.2s;
            margin-bottom: 0;
            height: 28px;
        }
        input[type="number"]:focus, input[type="text"]:focus {
            border: 1.2px solid #2563eb;
            outline: none;
            background: #fff;
        }
        input[readonly] {
            background: #e5e7eb;
            color: #555;
            border: 1.2px solid #e5e7eb;
        }
        .btns {
            text-align: center;
            margin-top: 8px;
        }
        button {
            padding: 8px 18px;
            border: none;
            border-radius: 7px;
            background: #2563eb;
            color: #fff;
            font-size: 1.01rem;
            font-weight: 600;
            margin-right: 8px;
            box-shadow: 0 2px 8px rgba(37,99,235,0.08);
            cursor: pointer;
            transition: background 0.18s, box-shadow 0.18s;
        }
        button:last-child { margin-right: 0; }
        button:hover {
            background: #1742a0;
            box-shadow: 0 4px 16px rgba(37,99,235,0.13);
        }
        .output-section {
            width: 100%;
            max-width: 340px;
            margin-top: 10px;
        }
        .output-section .form-title {
            margin-top: 0;
        }
        .output-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 6px 14px;
        }
        .output-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 0;
        }
        .output-row input[readonly] {
            font-size: 1.15rem;
            text-align: right;
            width: 100%;
            min-width: 90px;
            background: #e5e7eb;
            color: #222;
            font-weight: bold;
        }
        .history-section {
            max-width: 1100px;
            margin: 18px auto 0 auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(30, 60, 120, 0.07);
            padding: 12px 10px 18px 10px;
        }
        .history-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: #2563eb;
            margin-bottom: 8px;
        }
        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.97rem;
        }
        .history-table th, .history-table td {
            border: 1px solid #e5e7eb;
            padding: 4px 7px;
            text-align: center;
        }
        .history-table th {
            background: #f1f5f9;
            color: #2563eb;
        }
        .history-table tbody {
            max-height: 180px;
            overflow-y: auto;
        }
        @media (max-width: 1200px) {
            .main-flex, .history-section { max-width: 99vw; min-width: 0; }
        }
        @media (max-width: 900px) {
            .main-flex { flex-direction: column; gap: 10px; min-width: 0; }
            .right-panel { min-width: 0; max-width: 100vw; }
        }
    </style>
</head>
<body>
<div class="main-flex">
    <div class="left-panel">
        <h2>TDI Takt Time 계산기</h2>
        <form id="calcForm" autocomplete="off">
            <div class="form-section">
                <div class="form-title">Motion Setting</div>
                <div class="grid2">
                    <div class="form-row"><label>가속도 [G]</label><input type="number" step="any" name="accel_g" value="0.3"></div>
                    <div class="form-row"><label>가감속 거리 [mm]</label><input type="number" step="any" name="accel_dist" value="0"></div>
                    <div class="form-row"><label>가속 시간 [sec]</label><input type="number" step="any" name="accel_time" value="0"></div>
                    <div class="form-row"><label>Scan 등속 거리 [mm]</label><input type="number" step="any" name="scan_const_dist" value="0"></div>
                    <div class="form-row"><label>가감속 여유 거리 [mm]</label><input type="number" step="any" name="accel_margin" value="0"></div>
                    <div class="form-row"><label>총 스캔 거리 [mm]</label><input type="number" step="any" name="scan_total_dist" value="0"></div>
                    <div class="form-row"><label>Wafer Size [mm]</label><input type="number" step="any" name="wafer_size" value="310"></div>
                </div>
            </div>
            <div class="form-section">
                <div class="form-title">Camera Setting</div>
                <div class="grid2">
                    <div class="form-row"><label>Camera Resolution [μm]</label><input type="number" step="any" name="camera_res" value="0.1875"></div>
                    <div class="form-row"><label>Fov [pixel]</label><input type="number" step="any" name="fov_pixel" value="6000"></div>
                    <div class="form-row"><label>Camera Frequence [KHz]</label><input type="number" step="any" name="camera_freq" value="1000"></div>
                    <div class="form-row"><label>Scan Count</label><input type="number" step="any" name="scan_count" value="0"></div>
                    <div class="form-row"><label>Safety Factor [%]</label><input type="number" step="any" name="safety_factor" value="90"></div>
                    <div class="form-row"><label>Scan Speed [mm/s]</label><input type="number" step="any" name="scan_speed" value="100"></div>
                </div>
            </div>
            <div class="form-section">
                <div class="form-title">Process Setting</div>
                <div class="grid2">
                    <div class="form-row"><label>Scan Delay [sec]</label><input type="number" step="any" name="scan_delay" value="0.35"></div>
                    <div class="form-row"><label>Wafer Align Scan Count</label><input type="number" step="any" name="wafer_align_scan_count" value="1"></div>
                    <div class="form-row"><label>Process Delay [sec]</label><input type="number" step="any" name="process_delay" value="5"></div>
                </div>
            </div>
            <div class="btns">
                <button type="button" onclick="calculate()">계산</button>
                <button type="button" onclick="downloadExcel()">엑셀로 저장</button>
            </div>
        </form>
    </div>
    <div class="right-panel">
        <div class="motion-svg-wrap">
            <svg width="340" height="120" viewBox="0 0 340 120">
                <!-- 스테이지(입체감, 그림자) -->
                <ellipse cx="170" cy="55" rx="120" ry="28" fill="#b9fbc0" filter="url(#shadow)" />
                <ellipse cx="170" cy="60" rx="120" ry="28" fill="#d1fae5" />
                <!-- 웨이퍼(파랑, 그림자) -->
                <ellipse cx="170" cy="60" rx="60" ry="24" fill="#60a5fa" filter="url(#wshadow)" />
                <ellipse cx="170" cy="60" rx="60" ry="24" fill="#3b82f6" fill-opacity="0.25" />
                <!-- 300mm 텍스트 -->
                <text x="170" y="65" text-anchor="middle" font-size="15" fill="#222" font-weight="bold">300mm</text>
                <!-- 가속/감속 구간 화살표 및 라벨 -->
                <line x1="70" y1="100" x2="110" y2="100" stroke="#f59e42" stroke-width="3" marker-end="url(#arrow)" />
                <line x1="230" y1="100" x2="270" y2="100" stroke="#f59e42" stroke-width="3" marker-end="url(#arrow)" />
                <text x="90" y="115" text-anchor="middle" font-size="12" fill="#f59e42">가속</text>
                <text x="250" y="115" text-anchor="middle" font-size="12" fill="#f59e42">감속</text>
                <!-- 등속 구간(파랑) -->
                <line x1="110" y1="100" x2="230" y2="100" stroke="#2563eb" stroke-width="5" />
                <text x="170" y="115" text-anchor="middle" font-size="12" fill="#2563eb">등속</text>
                <!-- 가속/감속 그래프(곡선) -->
                <polyline points="70,110 110,80 230,80 270,110" fill="none" stroke="#f59e42" stroke-width="2.5" />
                <!-- 그림자 필터 -->
                <defs>
                    <filter id="shadow" x="0" y="0" width="1.5" height="1.5">
                        <feDropShadow dx="0" dy="4" stdDeviation="4" flood-color="#a7f3d0"/>
                    </filter>
                    <filter id="wshadow" x="0" y="0" width="1.5" height="1.5">
                        <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="#60a5fa"/>
                    </filter>
                    <marker id="arrow" markerWidth="8" markerHeight="8" refX="8" refY="4" orient="auto" markerUnits="strokeWidth">
                        <path d="M0,0 L8,4 L0,8" fill="#f59e42" />
                    </marker>
                </defs>
            </svg>
        </div>
        <div class="output-section">
            <div class="form-title">Full Scan</div>
            <div class="output-grid">
                <div class="output-row"><label>Scan Time [sec]</label><input type="number" name="full_scan_time" id="full_scan_time" readonly></div>
                <div class="output-row"><label>UPH</label><input type="number" name="full_uph" id="full_uph" readonly></div>
            </div>
            <div class="form-title" style="margin-top:12px;">Circle Scan</div>
            <div class="output-grid">
                <div class="output-row"><label>Scan Time [sec]</label><input type="number" name="circle_scan_time" id="circle_scan_time" readonly></div>
                <div class="output-row"><label>UPH</label><input type="number" name="circle_uph" id="circle_uph" readonly></div>
            </div>
        </div>
    </div>
</div>
<div class="history-section">
    <div class="history-title">연산 히스토리</div>
    <table class="history-table" id="historyTable">
        <thead>
            <tr>
                <th>Datetime</th>
                <th>Wafer Size</th>
                <th>Scan Speed</th>
                <th>ScanTime</th>
                <th>UPH</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
<script>
let historyList = [];
function calculate() {
    const form = document.getElementById('calcForm');
    const data = Object.fromEntries(new FormData(form).entries());
    fetch('/calculate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(result => {
        if(result.full_scan_time !== undefined) document.getElementById('full_scan_time').value = result.full_scan_time;
        if(result.full_uph !== undefined) document.getElementById('full_uph').value = result.full_uph;
        if(result.circle_scan_time !== undefined) document.getElementById('circle_scan_time').value = result.circle_scan_time;
        if(result.circle_uph !== undefined) document.getElementById('circle_uph').value = result.circle_uph;
        // 히스토리 추가
        const now = new Date();
        historyList.unshift({
            datetime: now.toLocaleString(),
            wafer_size: data.wafer_size,
            scan_speed: data.scan_speed,
            scan_time: result.full_scan_time,
            uph: result.full_uph
        });
        renderHistory();
    });
}
function renderHistory() {
    const tbody = document.getElementById('historyTable').querySelector('tbody');
    tbody.innerHTML = historyList.map(h =>
        `<tr><td>${h.datetime}</td><td>${h.wafer_size}</td><td>${h.scan_speed}</td><td>${h.scan_time}</td><td>${h.uph}</td></tr>`
    ).join('');
}
function downloadExcel() {
    const form = document.getElementById('calcForm');
    const data = Object.fromEntries(new FormData(form).entries());
    fetch('/download_excel', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    })
    .then(res => res.blob())
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'result.xlsx';
        document.body.appendChild(a);
        a.click();
        a.remove();
    });
}
// 페이지 로드시 히스토리 불러오기
window.onload = function() {
    fetch('/history')
        .then(res => res.json())
        .then(list => {
            historyList = list;
            renderHistory();
        });
}
</script>
</body>
</html> 